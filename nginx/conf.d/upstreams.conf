# User Service Upstream
upstream user-service {
    least_conn;
    server user-service:8080 weight=1 max_fails=3 fail_timeout=30s;
    # Thêm nhiều instance của user-service để load balancing
    # server user-service-2:8080 weight=1 max_fails=3 fail_timeout=30s;
    # server user-service-3:8080 weight=1 max_fails=3 fail_timeout=30s;
    
    # Health check
    keepalive 32;
}

# Order Service Upstream (sẽ thêm sau khi implement order-service)
upstream order-service {
    least_conn;
    server order-service:8081 weight=1 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Payment Service Upstream
upstream payment-service {
    least_conn;
    server payment-service:8082 weight=1 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Shop Service Upstream
upstream shop-service {
    least_conn;
    server shop-service:8083 weight=1 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Review Service Upstream
upstream review-service {
    least_conn;
    server review-service:8084 weight=1 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Shipping Service Upstream
upstream shipping-service {
    least_conn;
    server shipping-service:8085 weight=1 max_fails=3 fail_timeout=30s;
    keepalive 32;
}

# Notification Service Upstream
upstream notification-service {
    least_conn;
    server notification-service:8086 weight=1 max_fails=3 fail_timeout=30s;
    keepalive 32;
}
